{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranavbalaji/Documents/Personal%20CS%20Projects/chip%20count/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // Called from Server Component; ignore\n          }\n        }\n      }\n    }\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,oKAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,uCAAuC;gBACzC;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/pranavbalaji/Documents/Personal%20CS%20Projects/chip%20count/app/invite/%5Bcode%5D/page.tsx"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\nimport { redirect, notFound } from \"next/navigation\"\n\nasync function ensureProfile(\n  supabase: Awaited<ReturnType<typeof createClient>>,\n  userId: string,\n  email: string | null\n) {\n  const fallbackName = email ? email.split(\"@\")[0] : null\n\n  const { data: existing } = await supabase\n    .from(\"profiles\")\n    .select(\"display_name\")\n    .eq(\"id\", userId)\n    .single()\n\n  if (!existing) {\n    const { error } = await supabase.from(\"profiles\").insert({\n      id: userId,\n      email,\n      display_name: fallbackName\n    })\n    if (error) {\n      // If this fails, we still allow joining the game; profile can be fixed later.\n      console.error(\"Error ensuring profile in invite route:\", error)\n    }\n  }\n}\n\nexport default async function InvitePage({\n  params\n}: {\n  params: Promise<{ code: string }>\n}) {\n  const { code } = await params\n  const supabase = await createClient()\n  const {\n    data: { user }\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    redirect(`/login?next=${encodeURIComponent(`/invite/${code}`)}`)\n  }\n\n  await ensureProfile(supabase, user.id, user.email)\n\n  const shortCode = code.trim().toLowerCase()\n\n  const { data: game, error: gameError } = await supabase\n    .from(\"games\")\n    .select(\"id, status\")\n    .eq(\"short_code\", shortCode)\n    .single()\n\n  if (gameError || !game || game.status !== \"active\") {\n    notFound()\n  }\n\n  const { data: existingParticipation } = await supabase\n    .from(\"game_players\")\n    .select(\"status\")\n    .eq(\"game_id\", game.id)\n    .eq(\"user_id\", user.id)\n    .maybeSingle()\n\n  if (!existingParticipation) {\n    const { error: insertError } = await supabase.from(\"game_players\").insert({\n      game_id: game.id,\n      user_id: user.id,\n      status: \"pending\"\n    })\n\n    if (insertError && insertError.code !== \"23505\") {\n      console.error(\"Error joining game from invite link:\", insertError)\n      notFound()\n    }\n  }\n\n  redirect(`/game/${game.id}`)\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEA,eAAe,cACb,QAAkD,EAClD,MAAc,EACd,KAAoB;IAEpB,MAAM,eAAe,QAAQ,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG;IAEnD,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,YACL,MAAM,CAAC,gBACP,EAAE,CAAC,MAAM,QACT,MAAM;IAET,IAAI,CAAC,UAAU;QACb,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC;YACvD,IAAI;YACJ;YACA,cAAc;QAChB;QACA,IAAI,OAAO;YACT,8EAA8E;YAC9E,QAAQ,KAAK,CAAC,2CAA2C;QAC3D;IACF;AACF;AAEe,eAAe,WAAW,EACvC,MAAM,EAGP;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;IACvB,MAAM,WAAW,MAAM,IAAA,yIAAY;IACnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,IAAA,iMAAQ,EAAC,CAAC,YAAY,EAAE,mBAAmB,CAAC,QAAQ,EAAE,MAAM,GAAG;IACjE;IAEA,MAAM,cAAc,UAAU,KAAK,EAAE,EAAE,KAAK,KAAK;IAEjD,MAAM,YAAY,KAAK,IAAI,GAAG,WAAW;IAEzC,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAC5C,IAAI,CAAC,SACL,MAAM,CAAC,cACP,EAAE,CAAC,cAAc,WACjB,MAAM;IAET,IAAI,aAAa,CAAC,QAAQ,KAAK,MAAM,KAAK,UAAU;QAClD,IAAA,iMAAQ;IACV;IAEA,MAAM,EAAE,MAAM,qBAAqB,EAAE,GAAG,MAAM,SAC3C,IAAI,CAAC,gBACL,MAAM,CAAC,UACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,WAAW;IAEd,IAAI,CAAC,uBAAuB;QAC1B,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,CAAC;YACxE,SAAS,KAAK,EAAE;YAChB,SAAS,KAAK,EAAE;YAChB,QAAQ;QACV;QAEA,IAAI,eAAe,YAAY,IAAI,KAAK,SAAS;YAC/C,QAAQ,KAAK,CAAC,wCAAwC;YACtD,IAAA,iMAAQ;QACV;IACF;IAEA,IAAA,iMAAQ,EAAC,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;AAC7B"}}]
}